# GitHub Integration Guide

## Complete GitHub-n8n Automation System

### Overview

Transform GitHub Issues and Pull Requests into fully functional n8n workflows using AI-powered automation.

## Issue-Driven Development

### 1. Issue Templates

#### Workflow Request Template

```yaml
name: n8n Workflow Request
description: Request a new n8n workflow to be automatically generated
title: "[WORKFLOW]: "
labels: ["workflow-request", "ai-generation"]
assignees:
  - octocat
body:
  - type: markdown
    attributes:
      value: |
        ## Workflow Generation Request
        This issue will trigger automatic n8n workflow generation using Claude AI.
  
  - type: input
    id: workflow_name
    attributes:
      label: Workflow Name
      description: Name for the generated workflow
      placeholder: ex. customer-onboarding-automation
    validations:
      required: true
  
  - type: textarea
    id: description
    attributes:
      label: Workflow Description
      description: Describe what the workflow should do
      placeholder: |
        This workflow should:
        1. Receive webhook from signup form
        2. Create user in database
        3. Send welcome email
        4. Add to CRM
        5. Trigger onboarding sequence
    validations:
      required: true
  
  - type: dropdown
    id: trigger_type
    attributes:
      label: Trigger Type
      description: How should the workflow be triggered?
      options:
        - Webhook
        - Schedule/Cron
        - Email
        - Database Change
        - Manual
        - Other
    validations:
      required: true
  
  - type: textarea
    id: integrations
    attributes:
      label: Required Integrations
      description: List all services/APIs this workflow needs to connect to
      placeholder: |
        - Discord
        - OpenAI
        - PostgreSQL
        - SendGrid
        - Slack
  
  - type: textarea
    id: data_flow
    attributes:
      label: Data Flow
      description: Describe how data should flow through the workflow
      placeholder: |
        1. Input: JSON with user data
        2. Process: Validate and enrich data
        3. Store: Save to database
        4. Output: Return success/failure status
  
  - type: checkboxes
    id: features
    attributes:
      label: Required Features
      options:
        - label: Error Handling
        - label: Retry Logic
        - label: Rate Limiting
        - label: Data Validation
        - label: Logging
        - label: Notifications
  
  - type: textarea
    id: success_criteria
    attributes:
      label: Success Criteria
      description: How will we know the workflow is working correctly?
      placeholder: |
        - All test cases pass
        - Performance < 3 seconds
        - Error rate < 1%
```

### 2. Issue Processing Workflow

```yaml
name: Process Workflow Request Issue

on:
  issues:
    types: [opened, edited]
    
jobs:
  generate_workflow:
    if: contains(github.event.issue.labels.*.name, 'workflow-request')
    runs-on: ubuntu-latest
    
    steps:
      - name: Parse Issue Content
        id: parse
        run: |
          # Extract structured data from issue body
          WORKFLOW_NAME=$(echo "${{ github.event.issue.body }}" | grep -A1 "Workflow Name" | tail -1)
          echo "workflow_name=$WORKFLOW_NAME" >> $GITHUB_OUTPUT
      
      - name: Generate Workflow with Claude
        uses: ./.github/actions/claude-workflow-generator
        with:
          issue_number: ${{ github.event.issue.number }}
          workflow_name: ${{ steps.parse.outputs.workflow_name }}
          
      - name: Create PR with Generated Workflow
        uses: peter-evans/create-pull-request@v5
        with:
          title: "feat: Add ${{ steps.parse.outputs.workflow_name }} workflow"
          body: |
            ## Generated n8n Workflow
            
            This PR was automatically generated from issue #${{ github.event.issue.number }}
            
            ### Workflow Details
            - Name: ${{ steps.parse.outputs.workflow_name }}
            - Generated by: Claude AI
            - Status: Ready for review
            
            ### Next Steps
            1. Review the generated workflow
            2. Test in n8n sandbox
            3. Approve and merge
            
            Closes #${{ github.event.issue.number }}
          branch: workflow/${{ steps.parse.outputs.workflow_name }}
          labels: |
            ai-generated
            workflow
            needs-review
```

## Pull Request Automation

### 1. PR Templates

```markdown
## n8n Workflow PR Template

### Workflow Information
- **Name**: <!-- workflow name -->
- **Purpose**: <!-- what does this workflow do -->
- **Trigger**: <!-- how is it triggered -->

### AI Generation Instructions
<!-- If you want AI to generate or modify the workflow, provide instructions here -->

<workflow_intent>
<!-- Describe the intended functionality -->
</workflow_intent>

<requirements>
<!-- List specific requirements -->
</requirements>

### Testing
- [ ] Workflow syntax is valid
- [ ] All nodes are properly connected
- [ ] Error handling is implemented
- [ ] Performance tested
- [ ] Security reviewed

### Deployment
- [ ] Environment variables configured
- [ ] Credentials set up
- [ ] Monitoring enabled
- [ ] Documentation updated
```

### 2. PR Processing Actions

```yaml
name: PR Workflow Processor

on:
  pull_request:
    types: [opened, synchronize]
    paths:
      - 'workflows/**.json'
      - 'n8n_specs/**.md'

jobs:
  process_workflow:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Detect Changes
        id: changes
        run: |
          CHANGED_FILES=$(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.event.pull_request.head.sha }})
          echo "files=$CHANGED_FILES" >> $GITHUB_OUTPUT
      
      - name: Validate Workflow
        run: |
          for file in ${{ steps.changes.outputs.files }}; do
            if [[ $file == *.json ]]; then
              node scripts/validate-workflow.js "$file"
            fi
          done
      
      - name: AI Enhancement
        if: contains(github.event.pull_request.body, '<workflow_intent>')
        run: |
          node .github/scripts/enhance-workflow.js
      
      - name: Auto-commit Improvements
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "AI: Enhanced workflow based on PR requirements"
```

## GitHub Actions Library

### 1. Core Actions

#### claude-workflow-generator

```yaml
name: 'Claude Workflow Generator'
description: 'Generate n8n workflows using Claude AI'
inputs:
  prompt:
    description: 'Generation prompt'
    required: true
  model:
    description: 'Claude model to use'
    default: 'claude-4-sonnet-20241022'
  max_retries:
    description: 'Maximum retry attempts'
    default: '3'
outputs:
  workflow:
    description: 'Generated workflow JSON'
  status:
    description: 'Generation status'
runs:
  using: 'node20'
  main: 'dist/index.js'
```

#### workflow-validator

```yaml
name: 'Workflow Validator'
description: 'Validate n8n workflow structure and syntax'
inputs:
  workflow_file:
    description: 'Path to workflow JSON file'
    required: true
  strict_mode:
    description: 'Enable strict validation'
    default: 'true'
outputs:
  valid:
    description: 'Validation result'
  errors:
    description: 'List of validation errors'
runs:
  using: 'node20'
  main: 'dist/validator.js'
```

### 2. Composite Actions

#### complete-workflow-pipeline

```yaml
name: 'Complete Workflow Pipeline'
description: 'End-to-end workflow generation, validation, and deployment'

runs:
  using: "composite"
  steps:
    - name: Generate
      uses: ./.github/actions/claude-workflow-generator
      with:
        prompt: ${{ inputs.requirements }}
    
    - name: Validate
      uses: ./.github/actions/workflow-validator
      with:
        workflow_file: generated.json
    
    - name: Test
      uses: ./.github/actions/workflow-tester
      with:
        workflow_file: generated.json
    
    - name: Deploy
      uses: ./.github/actions/n8n-deployer
      with:
        workflow_file: generated.json
        environment: ${{ inputs.environment }}
```

## Webhook Integration

### 1. GitHub Webhook Handler

```javascript
// n8n webhook node configuration
{
  "type": "n8n-nodes-base.webhook",
  "parameters": {
    "httpMethod": "POST",
    "path": "github-webhook",
    "responseMode": "onReceived",
    "rawBody": true,
    "options": {
      "rawBody": true
    }
  }
}

// Processing code
const payload = JSON.parse($input.item.json.body);
const event = $input.item.headers['x-github-event'];

switch(event) {
  case 'issues':
    // Handle issue events
    if (payload.action === 'opened') {
      // Trigger workflow generation
    }
    break;
    
  case 'pull_request':
    // Handle PR events
    if (payload.action === 'opened') {
      // Validate and enhance workflow
    }
    break;
    
  case 'workflow_run':
    // Handle workflow run events
    if (payload.workflow_run.conclusion === 'success') {
      // Deploy to production
    }
    break;
}
```

### 2. n8n â†’ GitHub Integration

```javascript
// Create issue from n8n
{
  "type": "n8n-nodes-base.github",
  "parameters": {
    "operation": "create",
    "owner": "{{ $json.repo_owner }}",
    "repository": "{{ $json.repo_name }}",
    "title": "Workflow Error: {{ $json.workflow_name }}",
    "body": "Error details: {{ $json.error_message }}",
    "labels": ["bug", "workflow-error"]
  }
}

// Update PR status
{
  "type": "n8n-nodes-base.httpRequest",
  "parameters": {
    "method": "POST",
    "url": "https://api.github.com/repos/{{ $json.owner }}/{{ $json.repo }}/statuses/{{ $json.sha }}",
    "authentication": "predefinedCredentialType",
    "nodeCredentialType": "githubApi",
    "jsonParameters": true,
    "bodyParametersJson": {
      "state": "success",
      "description": "Workflow validated successfully",
      "context": "n8n/validation"
    }
  }
}
```

## CI/CD Pipeline

### 1. Multi-Stage Pipeline

```yaml
name: n8n Workflow CI/CD

on:
  push:
    branches: [main]
    paths:
      - 'workflows/**.json'

jobs:
  validate:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}
    steps:
      - uses: actions/checkout@v4
      - id: set-matrix
        run: |
          FILES=$(find workflows -name "*.json" -type f | jq -R -s -c 'split("\n")[:-1]')
          echo "matrix={\"file\":$FILES}" >> $GITHUB_OUTPUT
  
  test:
    needs: validate
    runs-on: ubuntu-latest
    strategy:
      matrix: ${{fromJson(needs.validate.outputs.matrix)}}
    steps:
      - name: Test Workflow
        run: |
          npm run test:workflow -- ${{ matrix.file }}
  
  deploy-staging:
    needs: test
    runs-on: ubuntu-latest
    environment: staging
    steps:
      - name: Deploy to Staging
        run: |
          npm run deploy:staging -- ${{ matrix.file }}
  
  deploy-production:
    needs: deploy-staging
    runs-on: ubuntu-latest
    environment: production
    if: github.ref == 'refs/heads/main'
    steps:
      - name: Deploy to Production
        run: |
          npm run deploy:production -- ${{ matrix.file }}
```

### 2. Rollback Strategy

```yaml
name: Workflow Rollback

on:
  workflow_dispatch:
    inputs:
      workflow_name:
        description: 'Workflow to rollback'
        required: true
      version:
        description: 'Version to rollback to'
        required: true

jobs:
  rollback:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch Previous Version
        run: |
          git checkout ${{ inputs.version }} -- workflows/${{ inputs.workflow_name }}.json
      
      - name: Validate Previous Version
        run: |
          npm run validate -- workflows/${{ inputs.workflow_name }}.json
      
      - name: Deploy Rollback
        run: |
          npm run deploy:rollback -- ${{ inputs.workflow_name }} ${{ inputs.version }}
      
      - name: Notify Team
        run: |
          curl -X POST ${{ secrets.SLACK_WEBHOOK }} \
            -d "{\"text\":\"Rolled back ${{ inputs.workflow_name }} to version ${{ inputs.version }}\"}"
```

## Monitoring & Alerts

### 1. Workflow Monitoring

```javascript
// Monitor workflow execution
const monitoringConfig = {
  metrics: {
    execution_time: true,
    success_rate: true,
    error_types: true,
    node_performance: true
  },
  alerts: {
    failure_threshold: 3,
    performance_degradation: 150, // percentage
    error_rate: 5 // percentage
  },
  notifications: {
    slack: true,
    email: true,
    github_issue: true
  }
};
```

### 2. Alert Configuration

```yaml
name: Workflow Health Check

on:
  schedule:
    - cron: '*/15 * * * *'  # Every 15 minutes

jobs:
  health_check:
    runs-on: ubuntu-latest
    steps:
      - name: Check Workflow Health
        run: |
          HEALTH=$(curl -s https://n8n.example.com/api/workflows/health)
          if [ "$HEALTH" != "healthy" ]; then
            gh issue create \
              --title "Workflow Health Alert" \
              --body "Workflows are unhealthy: $HEALTH" \
              --label "alert,production"
          fi
```

## Security Considerations

### 1. Secret Management

```yaml
# GitHub Secrets Configuration
secrets:
  ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
  N8N_API_KEY: ${{ secrets.N8N_API_KEY }}
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  WEBHOOK_SECRET: ${{ secrets.WEBHOOK_SECRET }}
```

### 2. Access Control

```yaml
# Branch Protection Rules
protection_rules:
  main:
    required_reviews: 1
    dismiss_stale_reviews: true
    require_code_owner_reviews: true
    required_status_checks:
      - "validate"
      - "test"
      - "security-scan"
    enforce_admins: false
    restrictions:
      users: ["lead-developer"]
      teams: ["n8n-team"]
```

## Best Practices

1. **Always use issue/PR templates** for consistency
2. **Implement comprehensive validation** before deployment
3. **Use environments** for staged deployments
4. **Enable branch protection** for production branches
5. **Monitor all workflows** continuously
6. **Document all custom actions** thoroughly
7. **Version control everything** including configurations
8. **Implement rollback mechanisms** for quick recovery
9. **Use secrets management** for sensitive data
10. **Regular security audits** of workflows and actions