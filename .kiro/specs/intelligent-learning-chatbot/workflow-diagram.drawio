<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="5.0" version="21.1.2" etag="v1" type="device">
  <diagram name="Intelligent Learning Chatbot n8n Workflow" id="chatbot-workflow">
    <mxGraphModel dx="2000" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2400" pageHeight="1600" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="Intelligent Learning Chatbot - n8n Workflow Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="800" y="20" width="800" height="40" as="geometry" />
        </mxCell>
        
        <!-- Phase 1: Basic Chatbot Flow -->
        <mxCell id="phase1-container" value="Phase 1: 基本チャットボット" style="swimlane;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="2320" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="webhook-trigger" value="Webhook&#xa;Trigger" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;" vertex="1" parent="phase1-container">
          <mxGeometry x="20" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="input-validation" value="Input&#xa;Validation&#xa;(IF Node)" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase1-container">
          <mxGeometry x="160" y="50" width="100" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="set-system-prompt" value="Set System&#xa;Prompt&#xa;(Set Node)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase1-container">
          <mxGeometry x="300" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="llm-chain" value="AI Agent&#xa;(LLM Chain)&#xa;OpenAI" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1;" vertex="1" parent="phase1-container">
          <mxGeometry x="440" y="50" width="120" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="format-response" value="Format&#xa;Response&#xa;(Set Node)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase1-container">
          <mxGeometry x="600" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="http-response" value="HTTP&#xa;Response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;" vertex="1" parent="phase1-container">
          <mxGeometry x="740" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <!-- Arrows for Phase 1 -->
        <mxCell id="arrow1-1" value="message" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="phase1-container" source="webhook-trigger" target="input-validation">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-2" value="valid" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="phase1-container" source="input-validation" target="set-system-prompt">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-3" value="prompt" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="phase1-container" source="set-system-prompt" target="llm-chain">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-4" value="AI response" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="phase1-container" source="llm-chain" target="format-response">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-5" value="JSON" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;" edge="1" parent="phase1-container" source="format-response" target="http-response">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Phase 2: Session & Storage -->
        <mxCell id="phase2-container" value="Phase 2: セッション管理 + 会話履歴保存" style="swimlane;fillColor=#f8cecc;strokeColor=#b85450;fontSize=14;fontStyle=1;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="300" width="2320" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="extract-session" value="Extract&#xa;Session ID&#xa;(Set Node)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase2-container">
          <mxGeometry x="20" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="check-session" value="Check Session&#xa;History&#xa;(PostgreSQL)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f7ff;strokeColor=#91d5ff;fontSize=12;" vertex="1" parent="phase2-container">
          <mxGeometry x="160" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="merge-context" value="Merge&#xa;Context&#xa;(Merge Node)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase2-container">
          <mxGeometry x="300" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="conversation-memory" value="Conversation&#xa;Memory&#xa;(Buffer)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;" vertex="1" parent="phase2-container">
          <mxGeometry x="440" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="save-conversation" value="Save&#xa;Conversation&#xa;(PostgreSQL)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f7ff;strokeColor=#91d5ff;fontSize=12;" vertex="1" parent="phase2-container">
          <mxGeometry x="580" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="error-trigger" value="Error&#xa;Trigger" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#ff6666;fontSize=12;" vertex="1" parent="phase2-container">
          <mxGeometry x="720" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="file-backup" value="File Backup&#xa;(Write File)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase2-container">
          <mxGeometry x="860" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <!-- Connect Phase 2 to LLM -->
        <mxCell id="session-to-llm" value="context" style="endArrow=classic;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.25;entryY=1;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#4285F4;fontSize=10;" edge="1" parent="1" source="conversation-memory" target="llm-chain">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="llm-to-save" value="response" style="endArrow=classic;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#4285F4;fontSize=10;" edge="1" parent="1" source="llm-chain" target="save-conversation">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Phase 3: Feedback -->
        <mxCell id="phase3-container" value="Phase 3: フィードバック機能" style="swimlane;fillColor=#d4e8fc;strokeColor=#6c8ebf;fontSize=14;fontStyle=1;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="520" width="2320" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="feedback-webhook" value="Feedback&#xa;Webhook" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1;" vertex="1" parent="phase3-container">
          <mxGeometry x="20" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="validate-feedback" value="Validate&#xa;Feedback&#xa;(IF Node)" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase3-container">
          <mxGeometry x="160" y="50" width="100" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="save-feedback" value="Save&#xa;Feedback&#xa;(PostgreSQL)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f7ff;strokeColor=#91d5ff;fontSize=12;" vertex="1" parent="phase3-container">
          <mxGeometry x="300" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="analyze-sentiment" value="Analyze&#xa;Sentiment&#xa;(Code Node)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase3-container">
          <mxGeometry x="440" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="update-weights" value="Update&#xa;Weights&#xa;(Set Node)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase3-container">
          <mxGeometry x="580" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="notify-slack" value="Notify Admin&#xa;(Slack)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f4cccc;strokeColor=#ea6b66;fontSize=12;" vertex="1" parent="phase3-container">
          <mxGeometry x="720" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <!-- Connect Feedback to LLM -->
        <mxCell id="feedback-to-llm" value="feedback&#xa;weights" style="endArrow=classic;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.75;entryY=1;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#EA4335;dashed=1;fontSize=10;" edge="1" parent="1" source="update-weights" target="llm-chain">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Phase 4: RAG Implementation -->
        <mxCell id="phase4-container" value="Phase 4: RAG実装 (Retrieval-Augmented Generation)" style="swimlane;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=14;fontStyle=1;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="740" width="2320" height="300" as="geometry" />
        </mxCell>
        
        <mxCell id="extract-query" value="Extract Query&#xa;(Set Node)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase4-container">
          <mxGeometry x="20" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="generate-embedding" value="Generate&#xa;Embedding&#xa;(OpenAI)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;" vertex="1" parent="phase4-container">
          <mxGeometry x="160" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="vector-search" value="Vector Search&#xa;(Pinecone)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;fontStyle=1;" vertex="1" parent="phase4-container">
          <mxGeometry x="300" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="retrieve-docs" value="Retrieve&#xa;Documents&#xa;(PostgreSQL)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f7ff;strokeColor=#91d5ff;fontSize=12;" vertex="1" parent="phase4-container">
          <mxGeometry x="440" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="rank-results" value="Rank Results&#xa;(Code Node)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase4-container">
          <mxGeometry x="580" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="build-context" value="Build RAG&#xa;Context&#xa;(Set Node)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase4-container">
          <mxGeometry x="720" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="rag-prompt" value="RAG Prompt&#xa;Template" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;" vertex="1" parent="phase4-container">
          <mxGeometry x="860" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <!-- Sub-workflow for embedding storage -->
        <mxCell id="embedding-storage" value="Embedding Storage Sub-workflow" style="swimlane;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;startSize=25;" vertex="1" parent="phase4-container">
          <mxGeometry x="20" y="160" width="940" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="batch-embeddings" value="Batch&#xa;Embeddings" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="embedding-storage">
          <mxGeometry x="20" y="40" width="90" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="store-vectors" value="Store Vectors&#xa;(Pinecone)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="embedding-storage">
          <mxGeometry x="140" y="40" width="90" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="update-index" value="Update Index" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="embedding-storage">
          <mxGeometry x="260" y="40" width="90" height="50" as="geometry" />
        </mxCell>
        
        <!-- Connect RAG to LLM -->
        <mxCell id="rag-to-llm" value="augmented&#xa;context" style="endArrow=classic;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeWidth=3;strokeColor=#34A853;fontSize=11;fontStyle=1;" edge="1" parent="1" source="rag-prompt" target="llm-chain">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        
        <!-- Phase 5: Learning Mechanism -->
        <mxCell id="phase5-container" value="Phase 5: 学習メカニズム (Scheduled Workflow)" style="swimlane;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=14;fontStyle=1;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="1060" width="2320" height="250" as="geometry" />
        </mxCell>
        
        <mxCell id="schedule-trigger" value="Schedule&#xa;Trigger&#xa;(Daily)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;fontStyle=1;" vertex="1" parent="phase5-container">
          <mxGeometry x="20" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="fetch-conversations" value="Fetch Recent&#xa;Conversations&#xa;(PostgreSQL)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f7ff;strokeColor=#91d5ff;fontSize=12;" vertex="1" parent="phase5-container">
          <mxGeometry x="160" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="fetch-feedback" value="Fetch&#xa;Feedback&#xa;(PostgreSQL)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f7ff;strokeColor=#91d5ff;fontSize=12;" vertex="1" parent="phase5-container">
          <mxGeometry x="300" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="pattern-analysis" value="Pattern&#xa;Analysis&#xa;(Code Node)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase5-container">
          <mxGeometry x="440" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="llm-analysis" value="LLM Analysis&#xa;(OpenAI)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;fontStyle=1;" vertex="1" parent="phase5-container">
          <mxGeometry x="580" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="generate-templates" value="Generate&#xa;Templates&#xa;(Set Node)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase5-container">
          <mxGeometry x="720" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="store-templates" value="Store&#xa;Templates&#xa;(PostgreSQL)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f7ff;strokeColor=#91d5ff;fontSize=12;" vertex="1" parent="phase5-container">
          <mxGeometry x="860" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="update-prompts" value="Update System&#xa;Prompts&#xa;(PostgreSQL)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f7ff;strokeColor=#91d5ff;fontSize=12;" vertex="1" parent="phase5-container">
          <mxGeometry x="1000" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="generate-report" value="Generate&#xa;Report&#xa;(HTML)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="phase5-container">
          <mxGeometry x="1140" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="send-email" value="Send Report&#xa;(Email)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f4cccc;strokeColor=#ea6b66;fontSize=12;" vertex="1" parent="phase5-container">
          <mxGeometry x="1280" y="60" width="100" height="60" as="geometry" />
        </mxCell>
        
        <!-- Connect Learning to Main LLM -->
        <mxCell id="learning-to-llm" value="improved&#xa;prompts" style="endArrow=classic;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#FBBC04;dashed=1;fontSize=10;" edge="1" parent="1" source="update-prompts" target="set-system-prompt">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1040" y="1040" />
              <mxPoint x="1420" y="1040" />
              <mxPoint x="1420" y="170" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Central LLM Connection Hub -->
        <mxCell id="llm-hub" value="LLM Integration Hub" style="swimlane;fillColor=#4285F4;strokeColor=#1967D2;fontSize=14;fontStyle=1;startSize=30;fontColor=#FFFFFF;" vertex="1" parent="1">
          <mxGeometry x="1500" y="400" width="400" height="320" as="geometry" />
        </mxCell>
        
        <mxCell id="hub-description" value="All workflows connect to central LLM" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontColor=#333333;" vertex="1" parent="llm-hub">
          <mxGeometry x="50" y="40" width="300" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="hub-inputs" value="Inputs:&#xa;• User Message&#xa;• Session Context&#xa;• RAG Context&#xa;• Feedback Weights&#xa;• System Prompts" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="llm-hub">
          <mxGeometry x="20" y="80" width="170" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="hub-outputs" value="Outputs:&#xa;• AI Response&#xa;• Conversation Log&#xa;• Embeddings&#xa;• Analytics Data" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="llm-hub">
          <mxGeometry x="210" y="80" width="170" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="hub-models" value="Supported Models:&#xa;• GPT-4 Turbo&#xa;• GPT-3.5 Turbo&#xa;• Claude 3&#xa;• Custom Fine-tuned" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="llm-hub">
          <mxGeometry x="20" y="190" width="170" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="hub-tools" value="LLM Tools:&#xa;• Web Search&#xa;• Database Query&#xa;• Code Execution&#xa;• API Calls" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="llm-hub">
          <mxGeometry x="210" y="190" width="170" height="100" as="geometry" />
        </mxCell>
        
        <!-- Error Handling Flow -->
        <mxCell id="error-flow" value="Error Handling & Fallback" style="swimlane;fillColor=#ffcccc;strokeColor=#ff6666;fontSize=14;fontStyle=1;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="1330" width="800" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="error-catch" value="Error Catch&#xa;(Try/Catch)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#ff6666;fontSize=12;" vertex="1" parent="error-flow">
          <mxGeometry x="20" y="50" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="error-log" value="Log Error&#xa;(PostgreSQL)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f7ff;strokeColor=#91d5ff;fontSize=12;" vertex="1" parent="error-flow">
          <mxGeometry x="160" y="50" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="fallback-response" value="Fallback&#xa;Response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="error-flow">
          <mxGeometry x="300" y="50" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="alert-admin" value="Alert Admin&#xa;(Email/Slack)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f4cccc;strokeColor=#ea6b66;fontSize=12;" vertex="1" parent="error-flow">
          <mxGeometry x="440" y="50" width="100" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="retry-queue" value="Retry Queue&#xa;(RabbitMQ)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;" vertex="1" parent="error-flow">
          <mxGeometry x="580" y="50" width="100" height="60" as="geometry" />
        </mxCell>
        
        <!-- Legend -->
        <mxCell id="legend" value="凡例 / Legend" style="swimlane;fillColor=#f5f5f5;strokeColor=#666666;fontSize=14;fontStyle=1;startSize=30;" vertex="1" parent="1">
          <mxGeometry x="1950" y="800" width="400" height="400" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-webhook" value="Webhook/Trigger" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="legend">
          <mxGeometry x="20" y="50" width="110" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-db" value="Database (PostgreSQL)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6f7ff;strokeColor=#91d5ff;fontSize=11;" vertex="1" parent="legend">
          <mxGeometry x="150" y="50" width="110" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-ai" value="AI/ML Node" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="legend">
          <mxGeometry x="20" y="110" width="110" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-logic" value="Logic/Transform" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="legend">
          <mxGeometry x="150" y="110" width="110" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-vector" value="Vector DB (Pinecone)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;" vertex="1" parent="legend">
          <mxGeometry x="20" y="170" width="110" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-notification" value="Notification" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f4cccc;strokeColor=#ea6b66;fontSize=11;" vertex="1" parent="legend">
          <mxGeometry x="150" y="170" width="110" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-error" value="Error Handling" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffcccc;strokeColor=#ff6666;fontSize=11;" vertex="1" parent="legend">
          <mxGeometry x="20" y="230" width="110" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-decision" value="Decision Node" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="legend">
          <mxGeometry x="150" y="220" width="110" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-arrow-types" value="Connection Types:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;" vertex="1" parent="legend">
          <mxGeometry x="20" y="300" width="150" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="legend-arrow-normal" value="Normal Flow" style="endArrow=classic;html=1;strokeWidth=1;fontSize=10;" edge="1" parent="legend">
          <mxGeometry x="20" y="330" width="100" height="20" as="geometry">
            <mxPoint x="20" y="340" as="sourcePoint" />
            <mxPoint x="120" y="340" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="legend-arrow-llm" value="To/From LLM" style="endArrow=classic;html=1;strokeWidth=3;strokeColor=#4285F4;fontSize=10;" edge="1" parent="legend">
          <mxGeometry x="150" y="330" width="100" height="20" as="geometry">
            <mxPoint x="150" y="340" as="sourcePoint" />
            <mxPoint x="250" y="340" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="legend-arrow-async" value="Async/Schedule" style="endArrow=classic;html=1;strokeWidth=2;dashed=1;fontSize=10;" edge="1" parent="legend">
          <mxGeometry x="20" y="360" width="100" height="20" as="geometry">
            <mxPoint x="20" y="370" as="sourcePoint" />
            <mxPoint x="120" y="370" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>