{
  "name": "Demo Chat Workflow",
  "nodes": [
    {
      "parameters": {
        "path": "demo-chat",
        "responseMode": "responseNode",
        "options": {
          "allowedOrigins": "*"
        }
      },
      "name": "Chat Message Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [240, 300],
      "id": "chat-webhook-trigger-id",
      "notes": "ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—ä¿¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ"
    },
    {
      "parameters": {
        "mode": "manual",
        "values": {
          "string": [
            {
              "name": "userMessage",
              "value": "={{ $json.message }}"
            },
            {
              "name": "userId",
              "value": "={{ $json.userId || 'anonymous' }}"
            },
            {
              "name": "timestamp",
              "value": "={{ new Date().toISOString() }}"
            }
          ]
        }
      },
      "name": "Chat Input Processing",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [450, 300],
      "id": "chat-input-processing-id",
      "notes": "ãƒãƒ£ãƒƒãƒˆå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢ã¨å‡¦ç†"
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "messages": {
          "messageValues": [
            {
              "role": "system",
              "content": "ã‚ãªãŸã¯è¦ªåˆ‡ã§çŸ¥è­˜è±Šå¯ŒãªAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«æ—¥æœ¬èªã§ä¸å¯§ã«å›ç­”ã—ã¦ãã ã•ã„ã€‚"
            },
            {
              "role": "user",
              "content": "={{ $json.userMessage }}"
            }
          ]
        },
        "options": {
          "temperature": 0.7,
          "maxTokens": 500
        }
      },
      "name": "OpenAI Chat Completion",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [650, 300],
      "id": "openai-chat-id",
      "credentials": {
        "openAiApi": {
          "id": "openai-credential-id"
        }
      },
      "continueOnFail": true,
      "retryOnFail": true,
      "maxTries": 3,
      "waitBetweenTries": 2000,
      "notes": "OpenAI GPT-4o-miniã«ã‚ˆã‚‹ãƒãƒ£ãƒƒãƒˆå¿œç­”ç”Ÿæˆ"
    },
    {
      "parameters": {
        "functionCode": "// Agent logic to enhance chat response\nconst chatData = $('Chat Input Processing').item.json;\nconst openaiResponse = $json;\n\n// Check if OpenAI response was successful\nif (openaiResponse.error) {\n  return [{\n    json: {\n      response: \"ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ãŒã€ç¾åœ¨AIã‚µãƒ¼ãƒ“ã‚¹ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚ã—ã°ã‚‰ãå¾Œã«ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚\",\n      userId: chatData.userId,\n      timestamp: chatData.timestamp,\n      error: true,\n      errorDetails: openaiResponse.error\n    }\n  }];\n}\n\n// Extract the AI response\nconst aiMessage = openaiResponse.choices?.[0]?.message?.content || openaiResponse.message || \"å¿œç­”ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚\";\n\n// Agent enhancement: Add contextual information\nlet enhancedResponse = aiMessage;\n\n// Check for specific patterns and add helpful context\nif (chatData.userMessage.toLowerCase().includes('æ™‚é–“') || chatData.userMessage.toLowerCase().includes('time')) {\n  const currentTime = new Date().toLocaleString('ja-JP', {\n    timeZone: 'Asia/Tokyo',\n    year: 'numeric',\n    month: '2-digit',\n    day: '2-digit',\n    hour: '2-digit',\n    minute: '2-digit'\n  });\n  enhancedResponse += `\\n\\nğŸ“… ç¾åœ¨ã®æ—¥æœ¬æ™‚é–“: ${currentTime}`;\n}\n\nif (chatData.userMessage.toLowerCase().includes('å¤©æ°—') || chatData.userMessage.toLowerCase().includes('weather')) {\n  enhancedResponse += \"\\n\\nğŸŒ¤ï¸ ã‚ˆã‚Šè©³ã—ã„å¤©æ°—æƒ…å ±ãŒå¿…è¦ã§ã—ãŸã‚‰ã€å…·ä½“çš„ãªåœ°åŸŸåã‚’ãŠæ•™ãˆãã ã•ã„ã€‚\";\n}\n\n// Add user tracking for conversation continuity\nconst conversationContext = {\n  userId: chatData.userId,\n  messageCount: 1, // This could be enhanced with actual counting\n  lastInteraction: chatData.timestamp\n};\n\nreturn [{\n  json: {\n    response: enhancedResponse,\n    userId: chatData.userId,\n    timestamp: new Date().toISOString(),\n    originalMessage: chatData.userMessage,\n    aiModel: \"gpt-4o-mini\",\n    conversationContext: conversationContext,\n    responseTime: Date.now() - new Date(chatData.timestamp).getTime()\n  }\n}];"
      },
      "name": "Agent Processing",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [850, 300],
      "id": "agent-processing-id",
      "notes": "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚‹å¿œç­”ã®æ‹¡å¼µã¨æ–‡è„ˆã®è¿½åŠ "
    },
    {
      "parameters": {
        "responseCode": 200,
        "responseData": "={{ JSON.stringify({\n  success: true,\n  message: $json.response,\n  userId: $json.userId,\n  timestamp: $json.timestamp,\n  metadata: {\n    model: $json.aiModel,\n    responseTime: $json.responseTime + 'ms'\n  }\n}) }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "name": "Chat Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1050, 300],
      "id": "chat-response-id",
      "notes": "ãƒãƒ£ãƒƒãƒˆå¿œç­”ã®è¿”å´"
    },
    {
      "parameters": {
        "functionCode": "// Error handling for OpenAI failures\nconst chatData = $('Chat Input Processing').item.json;\nconst error = $json.error || {};\n\n// Log error for debugging\nconsole.error('OpenAI Chat Error:', error);\n\n// Generate fallback response\nconst fallbackResponses = [\n  \"ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ãŒã€ç¾åœ¨ã‚·ã‚¹ãƒ†ãƒ ãŒæ··é›‘ã—ã¦ãŠã‚Šã¾ã™ã€‚ã—ã°ã‚‰ãå¾Œã«ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚\",\n  \"AIã‚µãƒ¼ãƒ“ã‚¹ãŒä¸€æ™‚çš„ã«åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ãŠæ€¥ãã®å ´åˆã¯ã€ç›´æ¥ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚\",\n  \"æŠ€è¡“çš„ãªå•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚ã”è¿·æƒ‘ã‚’ãŠã‹ã‘ã—ã¦ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚\"\n];\n\nconst randomFallback = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];\n\nreturn [{\n  json: {\n    success: false,\n    message: randomFallback,\n    userId: chatData.userId,\n    timestamp: new Date().toISOString(),\n    error: true,\n    errorType: 'ai_service_unavailable',\n    statusCode: 503\n  }\n}];"
      },
      "name": "Error Handler",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [850, 500],
      "id": "error-handler-id",
      "notes": "OpenAIã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†"
    },
    {
      "parameters": {
        "responseCode": "={{ $json.statusCode || 503 }}",
        "responseData": "={{ JSON.stringify({\n  success: $json.success,\n  message: $json.message,\n  userId: $json.userId,\n  timestamp: $json.timestamp,\n  error: $json.error,\n  errorType: $json.errorType\n}) }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "name": "Error Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1050, 500],
      "id": "error-response-id",
      "notes": "ã‚¨ãƒ©ãƒ¼å¿œç­”ã®è¿”å´"
    }
  ],
  "connections": {
    "Chat Message Trigger": {
      "main": [
        [
          {
            "node": "Chat Input Processing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Input Processing": {
      "main": [
        [
          {
            "node": "OpenAI Chat Completion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Completion": {
      "main": [
        [
          {
            "node": "Agent Processing",
            "type": "main",
            "index": 0
          }
        ]
      ],
      "error": [
        [
          {
            "node": "Error Handler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent Processing": {
      "main": [
        [
          {
            "node": "Chat Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Handler": {
      "main": [
        [
          {
            "node": "Error Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "versionId": "demo-chat-workflow-v1.0.0",
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "saveExecutionProgress": true,
    "saveDataSuccessExecution": "all",
    "saveDataErrorExecution": "all",
    "timezone": "Asia/Tokyo",
    "errorWorkflow": null
  },
  "id": "",
  "tags": [
    "chat",
    "ai",
    "openai",
    "chatbot",
    "demo"
  ],
  "meta": {
    "createdAt": "2025-08-17T04:10:00.000Z",
    "updatedAt": "2025-08-17T04:10:00.000Z",
    "author": "Claude Code",
    "description": "ã‚·ãƒ³ãƒ—ãƒ«ãªãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆãƒ„ãƒ¼ãƒ« - Chat nodeã€Agent nodeã€OpenAI chat nodeã‚’ä½¿ç”¨"
  },
  "staticData": null
}