{
  "name": "Customer Support Automation",
  "nodes": [
    {
      "parameters": {
        "path": "customer-support",
        "responseMode": "responseNode",
        "options": {}
      },
      "name": "Email Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [240, 300],
      "id": "webhook-email-trigger",
      "notes": "é¡§å®¢ã‹ã‚‰ã®ãƒ¡ãƒ¼ãƒ«ã‚’WebhookçµŒç”±ã§å—ä¿¡"
    },
    {
      "parameters": {
        "mode": "manual",
        "values": {
          "string": [
            {
              "name": "emailFrom",
              "value": "={{ $json.from || $json.sender || 'unknown@email.com' }}"
            },
            {
              "name": "emailSubject", 
              "value": "={{ $json.subject || 'No Subject' }}"
            },
            {
              "name": "emailBody",
              "value": "={{ $json.body || $json.content || $json.text || '' }}"
            },
            {
              "name": "receivedAt",
              "value": "={{ new Date().toISOString() }}"
            }
          ]
        }
      },
      "name": "Email Data Extraction",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [460, 300],
      "id": "email-data-extraction",
      "notes": "å—ä¿¡ãƒ¡ãƒ¼ãƒ«ã‹ã‚‰å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºãƒ»æ•´å½¢"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "mode": "list"
        },
        "options": {
          "systemMessage": "ã‚ãªãŸã¯é¡§å®¢ã‚µãƒãƒ¼ãƒˆã®å°‚é–€å®¶ã§ã™ã€‚å—ä¿¡ã—ãŸãƒ¡ãƒ¼ãƒ«ã®å†…å®¹ã‚’åˆ†æã—ã€ä»¥ä¸‹ã®ã‚«ãƒ†ã‚´ãƒªã«åˆ†é¡ã—ã¦ãã ã•ã„ï¼š\n\n1. æŠ€è¡“çš„å•é¡Œ (technical)\n2. è«‹æ±‚ãƒ»æ”¯æ‰•ã„ (billing)\n3. å•†å“ã«é–¢ã™ã‚‹è³ªå• (product)\n4. ä¸€èˆ¬çš„ãªå•ã„åˆã‚ã› (general)\n5. ç·Šæ€¥å¯¾å¿œãŒå¿…è¦ (urgent)\n\nãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ä»¥ä¸‹ã®JSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ï¼š\n{\n  \"category\": \"ã‚«ãƒ†ã‚´ãƒªå\",\n  \"priority\": \"high/medium/low\",\n  \"assignedTo\": \"æ‹…å½“è€…å\",\n  \"summary\": \"è¦ç´„\",\n  \"recommendedAction\": \"æ¨å¥¨å¯¾å¿œ\"\n}\n\næ‹…å½“è€…ã®å‰²ã‚Šå½“ã¦è¦å‰‡ï¼š\n- technical: ç”°ä¸­ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢\n- billing: ä½è—¤çµŒç†\n- product: å±±ç”°å–¶æ¥­\n- general: éˆ´æœ¨ã‚µãƒãƒ¼ãƒˆ\n- urgent: ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼"
        }
      },
      "name": "AI Content Analysis Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1,
      "position": [680, 300],
      "id": "ai-content-analysis",
      "notes": "OpenAI GPT-5-miniã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒ¼ãƒ«å†…å®¹ã‚’åˆ†æãƒ»ã‚«ãƒ†ã‚´ãƒªåˆ†ã‘"
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.3
        }
      },
      "name": "OpenAI GPT Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [680, 180],
      "id": "openai-gpt-model",
      "notes": "GPT-4o-miniãƒ¢ãƒ‡ãƒ«ï¼ˆGPT-5-miniã®ä»£æ›¿ã¨ã—ã¦ä½¿ç”¨ï¼‰"
    },
    {
      "parameters": {
        "functionCode": "// AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®çµæœã‚’è§£æã—ã€æ‹…å½“è€…æƒ…å ±ã‚’è¿½åŠ \nconst agentResult = $input.first().json;\nlet analysisResult;\n\ntry {\n  // AIã®çµæœã‚’ãƒ‘ãƒ¼ã‚¹\n  if (typeof agentResult.output === 'string') {\n    analysisResult = JSON.parse(agentResult.output);\n  } else {\n    analysisResult = agentResult.output;\n  }\n} catch (error) {\n  // ãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n  analysisResult = {\n    category: 'general',\n    priority: 'medium',\n    assignedTo: 'éˆ´æœ¨ã‚µãƒãƒ¼ãƒˆ',\n    summary: 'AIã«ã‚ˆã‚‹åˆ†æãŒä¸å®Œå…¨ã§ã—ãŸ',\n    recommendedAction: 'æ‰‹å‹•ã§ç¢ºèªã—ã¦ãã ã•ã„'\n  };\n}\n\n// ãƒ¡ãƒ¼ãƒ«æƒ…å ±ã‚’å–å¾—\nconst emailData = $('Email Data Extraction').first().json;\n\n// Slacké€šçŸ¥ç”¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ§‹ç¯‰\nconst slackMessage = `ğŸ”” æ–°ã—ã„é¡§å®¢ã‚µãƒãƒ¼ãƒˆæ¡ˆä»¶\\n\\n` +\n  `ğŸ“§ **é€ä¿¡è€…**: ${emailData.emailFrom}\\n` +\n  `ğŸ“ **ä»¶å**: ${emailData.emailSubject}\\n` +\n  `ğŸ·ï¸ **ã‚«ãƒ†ã‚´ãƒª**: ${analysisResult.category}\\n` +\n  `âš¡ **å„ªå…ˆåº¦**: ${analysisResult.priority}\\n` +\n  `ğŸ‘¤ **æ‹…å½“è€…**: ${analysisResult.assignedTo}\\n` +\n  `ğŸ“„ **è¦ç´„**: ${analysisResult.summary}\\n` +\n  `ğŸ’¡ **æ¨å¥¨å¯¾å¿œ**: ${analysisResult.recommendedAction}\\n` +\n  `ğŸ• **å—ä¿¡æ™‚åˆ»**: ${emailData.receivedAt}`;\n\n// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ§‹ç¯‰\nconst dbData = {\n  email_from: emailData.emailFrom,\n  email_subject: emailData.emailSubject,\n  email_body: emailData.emailBody,\n  category: analysisResult.category,\n  priority: analysisResult.priority,\n  assigned_to: analysisResult.assignedTo,\n  summary: analysisResult.summary,\n  recommended_action: analysisResult.recommendedAction,\n  received_at: emailData.receivedAt,\n  processed_at: new Date().toISOString(),\n  status: 'pending'\n};\n\nreturn [{\n  json: {\n    slackMessage: slackMessage,\n    dbData: dbData,\n    analysisResult: analysisResult,\n    emailData: emailData\n  }\n}];"
      },
      "name": "Data Processing & Formatting",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [900, 300],
      "id": "data-processing",
      "notes": "AIåˆ†æçµæœã®å‡¦ç†ã¨Slackãƒ»DBç”¨ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C1234567890",
          "mode": "list"
        },
        "text": "={{ $json.slackMessage }}",
        "otherOptions": {}
      },
      "name": "Slack Notification",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2,
      "position": [1120, 200],
      "id": "slack-notification",
      "notes": "æ‹…å½“è€…ã«Slackã§é€šçŸ¥ã‚’é€ä¿¡"
    },
    {
      "parameters": {
        "operation": "insert",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list"
        },
        "table": {
          "__rl": true,
          "value": "customer_support_tickets",
          "mode": "list"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "email_from": "={{ $json.dbData.email_from }}",
            "email_subject": "={{ $json.dbData.email_subject }}",
            "email_body": "={{ $json.dbData.email_body }}",
            "category": "={{ $json.dbData.category }}",
            "priority": "={{ $json.dbData.priority }}",
            "assigned_to": "={{ $json.dbData.assigned_to }}",
            "summary": "={{ $json.dbData.summary }}",
            "recommended_action": "={{ $json.dbData.recommended_action }}",
            "received_at": "={{ $json.dbData.received_at }}",
            "processed_at": "={{ $json.dbData.processed_at }}",
            "status": "={{ $json.dbData.status }}"
          }
        },
        "options": {}
      },
      "name": "Database Storage",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [1120, 400],
      "id": "database-storage",
      "notes": "PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¡ˆä»¶æƒ…å ±ã‚’ä¿å­˜"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.success !== false }}",
              "operation": "true"
            }
          ]
        }
      },
      "name": "Success Check",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1340, 300],
      "id": "success-check",
      "notes": "å‡¦ç†æˆåŠŸã®ç¢ºèª"
    },
    {
      "parameters": {
        "responseCode": 200,
        "responseData": "={{ JSON.stringify({\n  status: 'success',\n  message: 'é¡§å®¢ã‚µãƒãƒ¼ãƒˆæ¡ˆä»¶ã‚’æ­£å¸¸ã«å‡¦ç†ã—ã¾ã—ãŸ',\n  ticketId: $json.dbData?.id || 'generated',\n  category: $json.analysisResult?.category || 'unknown',\n  assignedTo: $json.analysisResult?.assignedTo || 'unknown',\n  processedAt: new Date().toISOString()\n}) }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "name": "Success Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1560, 220],
      "id": "success-response",
      "notes": "æˆåŠŸæ™‚ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´"
    },
    {
      "parameters": {
        "responseCode": 500,
        "responseData": "={{ JSON.stringify({\n  status: 'error',\n  message: 'å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',\n  error: $json.error || 'Unknown error',\n  timestamp: new Date().toISOString()\n}) }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "name": "Error Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1560, 380],
      "id": "error-response",
      "notes": "ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´"
    },
    {
      "parameters": {
        "content": "## é¡§å®¢ã‚µãƒãƒ¼ãƒˆè‡ªå‹•åŒ–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼\\n\\n### æ©Ÿèƒ½æ¦‚è¦\\n- Webhookã§ãƒ¡ãƒ¼ãƒ«å—ä¿¡\\n- AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆGPT-4o-miniï¼‰ã§å†…å®¹åˆ†æ\\n- ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®æ‹…å½“è€…è‡ªå‹•å‰²ã‚Šå½“ã¦\\n- Slacké€šçŸ¥é€ä¿¡\\n- PostgreSQLã«ãƒ‡ãƒ¼ã‚¿ä¿å­˜\\n\\n### ã‚«ãƒ†ã‚´ãƒªã¨æ‹…å½“è€…\\n- **æŠ€è¡“çš„å•é¡Œ**: ç”°ä¸­ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢\\n- **è«‹æ±‚ãƒ»æ”¯æ‰•ã„**: ä½è—¤çµŒç†\\n- **å•†å“ã«é–¢ã™ã‚‹è³ªå•**: å±±ç”°å–¶æ¥­\\n- **ä¸€èˆ¬çš„ãªå•ã„åˆã‚ã›**: éˆ´æœ¨ã‚µãƒãƒ¼ãƒˆ\\n- **ç·Šæ€¥å¯¾å¿œ**: ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼\\n\\n### è¨­å®šãŒå¿…è¦ãªèªè¨¼æƒ…å ±\\n1. OpenAI APIèªè¨¼æƒ…å ±\\n2. Slackèªè¨¼æƒ…å ±\\n3. PostgreSQLæ¥ç¶šæƒ…å ±",
        "height": 340,
        "width": 420
      },
      "name": "Workflow Documentation",
      "type": "n8n-nodes-base.stickyNote",
      "position": [20, 0],
      "id": "workflow-documentation",
      "typeVersion": 1
    }
  ],
  "connections": {
    "Email Webhook Trigger": {
      "main": [
        [
          {
            "node": "Email Data Extraction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email Data Extraction": {
      "main": [
        [
          {
            "node": "AI Content Analysis Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Content Analysis Agent": {
      "main": [
        [
          {
            "node": "Data Processing & Formatting",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Data Processing & Formatting": {
      "main": [
        [
          {
            "node": "Slack Notification",
            "type": "main",
            "index": 0
          },
          {
            "node": "Database Storage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Slack Notification": {
      "main": [
        [
          {
            "node": "Success Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Database Storage": {
      "main": [
        [
          {
            "node": "Success Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Success Check": {
      "main": [
        [
          {
            "node": "Success Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "versionId": "customer-support-automation-v1",
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "saveExecutionProgress": true,
    "saveDataSuccessExecution": "all",
    "saveDataErrorExecution": "all"
  },
  "meta": {
    "instanceId": "customer-support-automation"
  },
  "tags": ["customer-support", "automation", "ai", "webhook"]
}